# 데이터 분석 심화

## TCT

문제 상황에 대해 충분히 이해를 하고 -> TO-BE 이미지를 그리는 것에 집중적으로 답변을 적어야 함. 

(알고리즘 위주 x 딥러닝 어쩌고 x)

어떤게 문제인지 파악을 하고 -> 어떤 식으로 접근하면 좋을지에 대한 것을 서술 하고 -> 이후 적용 단까지 종합적으로 A부터 Z까지를 고려하여 답변을 적어야 함. 

답변을 길게, 알고리즘에 대해서 충실하게 답변을 모두 적어도 분석 과제의 TO-BE 이미지를 제대로 그리지 못하면 점수를 잘 줄 수 없음.

 

## 본 교육 - 오전

### 분석 프로세스 및 to-be 프로세스

1. 세부적인 문제정의
   1. 문제가 간헐적으로 발생하고 있는지
   2. 한번 발생했는데 큰 규모인지
   3. 문제가 점점 커져 갈 것인지에 대한 문제가 발생하는 주기부터
   4. 불량률을 detect하고 싶은 것인지
   5. 불량 예측을 하려는 것인지에 대한 구체적인 문제 정의. 
2. 가설수립까지 진행하고 나서는 바로 모델링을 진행하는 것이 아니라 to-be이미지를 정의하여야 함. 해당 to-be이미지를 가장 잘 그릴 수 있기 위한 목적으로 알고리즘 방법론 정의가 시작 되는 것. 
3. EDA진행 전, 어떠한 관계성을 살펴보고 싶다를 미리 정한 뒤에 EDA를 하는 것이 좋음. 순서가 역이 되면 인사이트 발굴이 힘듬 (목적을 가지고 EDA를 하라)
4. 모델링은 간단
5. 평가가 중요한데 평가 과정에서 학습 데이터는 10만건을 쓸지, 100만건을 쓸지 학습 주기는 어떻게 할지 등을 세부적으로 결정해야 하고, 평가 단에서 ~한 추가 데이터가 더 필요하고, 학습 데이터는 최소 00만건 필요하다 라는 것이 다 정의가 되면 현업 담당자와 협의 후 데이터를 추가 마련 하고
6. 이후 운영/배포/배치 등의 작업이 들어가야 함. 
7. 대부분의 고객은 모델을 운영 할 수 있는 역량과 환경이 안되기 때문에분석 환경 구축(?) 에 대한 논의가 반드시 필요함.
   1. dap mldl을 추천하면 사용료 계속 받기 때문에 제일 좋음 / 그게 아니더라도 어느정도 데이터와 모델이 돌아갈 수 있을 만한 사양의 분석 환경 구축 필요)
8. 이상탐지를 한다고 하면 단순히 알고리즘을 생각하는것이 아니라, 이상이 탐지되고 나서 이상요인을 도출하고 나면 그것을 email로 알려줄지, sms로 알려줄지 등 모든 일련의 과정을 다 고려하는 것이 to-be이미지 프로세스임. 



### 데이터 타입

1. 시간별, 개체별 데이터 

   - 유플러스 같이 멤버십 데이터를 가지고 있는 기업들의 데이터가 주로 이에 해당. 

     -> 한 개체(한 사람) 에 대해서는 시간순에 따라 자기상관성이 존재하게 됨. ID가 관측개체일때, 동일 ID에 대해서는 관측치 간에 correlation이 강함. 

     -> 그러나 머신러닝 모델을 일반적으로 적용할때에는, 관측치 간에 독립성이 요구되는 경우가 많음. 따라서 추론의 단위를 독립으로 맞추어 주어야 함. 즉, 관측개체인 ID를 하나의 row로 처리 하여야 함. (행간독립 만들기, 하나의 ID에 모든 월의 데이터 넣기)

     -> 그러나 사람마다 데이터 이용 기간이라던지, 멤버십 이용 기간이 다르기 때문에 필연적으로 결측치가 발생하게 됨. 

     -> 기존의 달에 대한 정보를 없애고, 특정 해지 시점의 직전/직후 정보를 활용한다고 하면 위와 같은 문제점을 해결 할 수 있음. (3월컬럼, 4월컬럼이 아니라 해지 시점의 2시점 전, 1시점 전)

   - LGIT 카메라모듈 생산 데이터도 해당 데이터 형식임.

     -> 이 데이터 역시 모델링을 위해서는 제품 ID가 각각 row로 들어가게끔 wide_form으로 데이터 형식을 변환 해 주어야 함. (동일한 제품 ID에 대해서는 공정이나 설비 변수에 대해 자기상관이 반드시 존재하기 때문)

2. 시계열 데이터

   - 특정 관측 개체가 존재하는 것이 아닌, 시간의 흐름에 따라 그냥 쭉 조사가 된 데이터임. (제조 생산, 품질 데이터 등등)

   - 각 인자(각 변수)가 조사되는 시점이 서로 다를 수 있다는 특징이 있음. 

     -> 결측이 존재할 수 있는데, 이를 방지하기 위해 TimeFrame(1분단위, 5분단위 등등) 을 분석가가 다시 정의해야 할 수 있음. 그래서 한 timeframe에 관측값이 여러개일 수 있고, 그럴때 median값을 넣는다던지 등의 대표값을 이용하여 데이터마트를 구성해야 함. 

     -> 모든 컬럼에 대해서 자기상관이 존재한다는 특징이 있음(행간 독립이 하나도없음.) 따라서 독립성을 만들기 위해서 3분단위로 평균값을 만든다던지 하는 방식을 주로 사용.

     -> 즉 data sumamry를 두번 하는 것임. 일차적으로 timeframe을 선정해서 데이터마트를 구성하고, 해당 데이터마트에서 행간의 독립성을 최대한 가져가기 위해 time frame을 한번 더 구성해서 머신러닝 모델링용 데이터마트를 또 구성함. 

   - 특히, 공정 데이터에서 동일 제품의 상태를 모델링 하기 위해서는 공정간 시차를 고려하여 재병합 하는 과정이 필요함. 

     -> tag1 -> tag2 간에 한시간 차이가 난다고 하면, 특정 시점에서 두가지 공정 데이터를 모두 사용하고자 한다면 1시간의 타임gap을 고려하여야 함. 

3. 공간(시계열) 데이터

   - 위도 경도 등의 데이터가 이에 해당. 통신사 기지국 데이터, 신용카드 가맹점 데이터, 가스 검출기 데이터 등등이 해당하며 가까운 위치의 값은 서로 유사함을 가정함. (시계열 데이터의 2차원 버전!)  




## 본 교육-오후

### 예측/ 분류모형

1. 시계열 예측모형 

   시계열/non시계열에서 데이터 형태를 wide-form으로 변환 후 모델링 진행 하는 것을 추천. 

   - 고려할 점 1

     고려해야 할 것은 dependency가 어디에 존재하느냐인데, long form 형태를 wide form으로 바꾸어서 row간의 독립성을 어느정도 보장하게 되면, row 순서가 변경되어도 관계가 없어지므로 데이터 셔플 역시 가능 해 지고, train valid test 분할 시 time dependency를 고려하지 않아도 됨. 

     시계열 모델을 사용하지 않는 경우, 예측하고자 하는 시점과 예측값이 필요한 시점간의 시차만큼 y변수와 x변수 간의 시차를 두어야 함. 

     시계열 모델의 결과처럼 미래 여러시점(t+1, t+2,..t+h)의 예측결과를 시계열모델이 아닌 지도학습 모델로 예측하기 위해서는 예측시점의 개수만큼 (h) 모델을 학습해야 함. 

   - 고려할 점 2 - column dependency는 어떻게 해결해야 하는가? 

     - 교호작용 변수추가(선형모형), 트리기반 모델사용
  - 변수선택(대표변수), PCA, 독립이지만 Y와 상관성은 안높음
     - PLS(CNN), 추출된 인자가 서로 독립이면서 Y와 상관성 높음

     선형 회귀의 분석에는 다중공선성이라는 문제가 생기지만, 예측모형일 경우에는 크게 x간의 독립성을 고려하지 않아도 됨. (비편향 추정치이기 때문에 예측값의 분산이 큰 것이지, 예측값 자체에는 편향이 없기 때문!)

     예측을 할 때 중요한 것은 error term을 줄이는 것 뿐임. 

   - 평가

     y값의 범위를 고려하여 mae, mape 등의 적절한 metric을 선정하여야 함. 

     y값이 지나치게 작으면 (1 이하) mape가 200% 등 너무 비대하게 커보일 수 있음. 
   
     불량 누출을 최소화 할 것인지, 양품 누출을 최소화 할 것인지에 따라 metric을 적절히 고려 해야 함. 
   
     recall(실제 참 중 참으로 예측), precision(참으로 예측 중 실제 참)
     
     1. 불량 누출을 최소화 할 때, (순수 불량만을 선별) cutoff 선정 시 불량 recall을 95%로 고정후, accuracy, precision등을 비교. (5% 누출 허용)
     2. 양품 누출을 최소화 할 때, (순수 양품만을 선별) cutoff 선정 시 양품 recall을 95%로 고정후 accuracy precision등을 비교. 



### 알고리즘

1. 수치예측:선형회귀
   1. 장 : 해석 직관적, 영향력 크기비교 쉬움, 유의 인자 선택 가능
   2. 단 : 연산속도 데이터 수에 비례, 이상치 영향 많음
   3. 단 : 비현실적 가정(정규성 독립성 등)
      1. 가정 맞추기 위해 수작업과 주관적판단필요
2. 수요예측:시계열
   1. 장 : 설명변수가 없어도 변동상태 확인가능, 민감한 변동 빠르게 반영, 계절적 특성반영
   2. 단 : 정상시계열 변환 수작업, 주관적 판단 요구
   3. 단 : 모델이 복잡
3. 분류예측:로지스틱
   1. 장 : 합리적 예측값 도출, 영향력 크기 비교 쉬움, 유의인자 선택
   2. 단 : 연산속도 데이터 수에 비례, 이상치 영향 많음
   3. 단 : 비현실적 가정(정규성 독립성 등)
      1. 가정 맞추기 위해 수작업과 주관적판단필요
4. 분류:SVM
   1. 장 : 높은정확도, 과적합방지, 예측 가능
   2. 단 : 테스트 많음, 속도느림, 해석 어려움, 시각화 어려움
5. RF
   1. 장 : 과적합강함, 조정 없이도 높은 정확도
   2. 단 : 고차원, sparse 데이터 학습어려움, 속도 느림, 메모리과다, 해석어려움
6. XGBoost
   1. 장: 과적합강함, 속도빠름, 높은 정확도, 교차검증가능, 변수중요도 시각화, 다양한 손실함수사용
   2. 단 : GBM보다 빠를뿐임, 초파라미터튜닝 많이필요, 해석어려움
7. LightGBM
   1. 장 : XGBoost보다 빠름, 메모리적게사용, 정확도 높음
   2. 단 : 과적합 쉬움, 해석어려움
8. 신경망
   1. 장 : 정확도 높음, 수학적으로 복잡해도 용이, 다양한 데이터 형태 분석 가능
   2. 단 : 과적합, 해석설명어려움, 시간오래걸림, 데이터와 초파라미터에 영향 많이받음



### 영향인자발굴 및 최적조건 도출

영향인자발굴 - 영향인자는 원인인자와 다르다

1. 변수선택
   1. 전진선택법
   2. 후진소거법
   3. 단계선택법
   4. AIC와 BIC로 영향력을 판단
2. 변수중요도(트리기반)
   1. 장 : 중요변수 추출 및 영향인자 도출, 한눈에 파악가능
   2. 단 : 중요도 기준에 따라 변수 상이함. 영향의 방향 알수없음, 편향적일 수 있음
3. 주성분 분석
   1. 변수 상관관계가 높을 겨우 대표 주성분 추출



최적 조건 도출

1. 의사결정나무
   1. 장 : 불량률에 기여하는 유의한 변수들만 기준으로 빠르게 최적 조건 도출
   2. 단 : 고정적으로 확인하고 싶은 변수를 포함한 조건 도출이 어려움
2. 그리드서치
   1. 장 : 분석가나 고객이 원하는 값 확인 용이
   2. 단 : 시간이 오래걸림



### 이상감지

1. 방법론
   1. 지도학습
      1. 종속변수 명확 정의(1, 0)
      2. 이상건수 10% 이상필요
         1. 오버샘플링하면 과대적합
         2. 언더샘플링하면 부트스트랩 반복추출활용
      3. 신규 이상 탐지 불가
   2. 비지도학습
      1. 정상인 데이터만으로 학습
      2. 이상알람 과도 발생 가능성
      3. 이상 != 사고
         1. 사고 예측 모델 필요성
      4. 신규 이상 탐지 가능
2. 알고리즘
   1. 호텔링 T^2
      1. 이상징후 판단을 위한 정상범위의 관리선을 산출함
      2. 변수간 상관관계 높으면 안됨
         1. PCA 후 계산함
   2. 오토인코더
      1. 이상데이터가 들어오면 차이가 많이남
   3. Isolation F
      1. 이상값은 얕은 depth에서 분리가 끝남
      2. 계산량이 적음, 고차원은 작동이 어려워 차원 축소 필요
   4. 단일 클래스 SVM
      1. 정상데이터만 사용하여 초평면 찾기
      2. 초평면 밖에 있으면 이상치
   5. Dynamic Time Warping
      1. 시계열 데이터, 유사정도 계산
      2. 장 : 길이가 다른 패턴 유사도 계산, shift패턴도 계산
      3. 단 : 특정 상황에서 반대가 되는 패턴을 도출할수도있음


### 텍스트 분석

1. 전처리필요
2. BOW 모델을 통한 감성분석
3. 문서군집화
   1. 코사인 유사도



### 추천시스템

1. 콘텐츠 기반 필터링
   1. 장 : 다른 사용자 데이터 필요없음, 새 아이템 추천 가능, 이유설명 용이
   2. 단 : 소리,영상 이미지 콘텐츠에서 특징 추출 어려움, 새로운 사용자는 어려움, 너무 특화추천
2. 협업 필터링
   1. 사용자 기반
   2. 아이템 기반
   3. 희소행렬 문제, 백지 상태 시작 문제
   4. 장 : 아이템 특성의존 X
   5. 단 : 충분한 사용자 정보필요, 새로운 아이템이나 독특한 아이템 추천 어려움
3. 연관성 분석
   1. 장 : 결과 이해쉬움, 분석 계산이 단순
   2. 단 : 상품수가 많으면 계산수 과다, 품목이 세분화되면 안됨